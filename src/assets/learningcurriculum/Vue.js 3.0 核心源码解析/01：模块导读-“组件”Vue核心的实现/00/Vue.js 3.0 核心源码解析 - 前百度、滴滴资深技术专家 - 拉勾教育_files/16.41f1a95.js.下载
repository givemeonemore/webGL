(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{1882:function(e,t,s){"use strict";s.r(t);var r=s(2608);for(var i in r)["default"].indexOf(i)<0&&function(e){s.d(t,e,(function(){return r[e]}))}(i);var a=s(3510),o=s.n(a),n=s(3511),u=s(64);var l=function(e){s(3509)},d=Object(u.a)(o.a,n.a,n.b,!1,l,"data-v-baca6d4c",null);t.default=d.exports},2608:function(e,t,s){"use strict";var r=s(45);s(21)(t,"__esModule",{value:!0}),t.default=void 0;var i=r(s(21)),a=r(s(443)),o=r(s(444)),n=r(s(175)),u=r(s(445)),l=r(s(442)),d=r(s(421)),c=r(s(482)),h=r(s(403)),p=r(s(420)),f=s(409),y=s(1521),m=s(461),I=s(474),P=s(544);function C(e,t){var s=(0,l.default)(e);if(u.default){var r=(0,u.default)(e);t&&(r=r.filter((function(t){return(0,n.default)(e,t).enumerable}))),s.push.apply(s,r)}return s}function v(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?C(Object(s),!0).forEach((function(t){(0,p.default)(e,t,s[t])})):o.default?(0,a.default)(e,(0,o.default)(s)):C(Object(s)).forEach((function(t){(0,i.default)(e,t,(0,n.default)(s,t))}))}return e}var H={name:"CourseVideo",components:{VideoPlayer:r(s(1522)).default},data:function(){return{player:null,uploadPlayInfo:!1,uploadPlayAuth:!1,appVersion:"",isReportHeart:!0,isTCPlayer:!0,appId:null,fileId:null,lessonId:null,isFirstCanPlay:!0,videoConfig:{}}},computed:v(v({},(0,f.mapGetters)(["currentCourseLessons","courseInfo","hasPurchaseClass","playerStatus","playerSecondCurrentTime","isTCPlayerChannel","iscanHideFast"])),{},{getBasicInfo:function(){return{userId:window.userInfo&&window.userInfo.id||"",currentEnvironment:this.currentEnvironment,browserName:m.browserName||"",OSName:m.OSName,browserVersion:m.fullVersion||"",appVersion:this.appVersion||"",courseId:this.currentCourseLessons.courseId,lessonId:this.currentCourseLessons.id}}}),created:function(){(0,I.isApp)()&&(this.appVersion=(0,I.getAppVersion)())},mounted:function(){this.getLessonPlayHistory()},beforeDestroy:function(){this.player&&this.player.getCurrentTime()&&this.currentCourseLessons.id===this.playerStatus.id&&this.setFormatPlayerCurrentTime(this.player.getCurrentTime()),clearTimeout(this.uploadPlayInfo),clearInterval(this.uploadPlayAuth),this.uploadPlayAuth=!1,this.uploadPlayInfo=!1,this.updateCourseLessonsHistory(!0),this.player&&this.player.dispose(),this.setIsReportHeart(!1),this.isReportHeart=!0},methods:v(v({},(0,f.mapActions)(["setCurrentCourseLessons","setFormatPlayerCurrentTime","setLessonPlayer","setIsReportHeart","setLessonHistoryReq"])),{},{initData:function(e){var t=this.currentCourseLessons,s=t.appId,r=(t.videoMediaDTO,t.id,e.aliPlayAuth),i=e.fileId,a=e.encryptMedia;this.videoConfig={appId:s,fileId:i,playAuth:r,isTCPlayer:this.isTCPlayerChannel,encryptMedia:a,controlBar:{playbackRateMenuButton:!this.iscanHideFast,progressControl:!this.iscanHideFast}},this.playerStatus&&this.playerStatus.isPlaying&&this.setLessonPlayer({id:this.playerStatus.id,isPlaying:!1})},setPlayer:function(e){this.player=e},getLessonPlayHistory:function(){var e=this;(0,P.fetchLessonPlayHistory)({lessonId:this.currentCourseLessons.id||""}).then((function(t){if(1===t.state){var s=t.content,r=s.historyNode,i=void 0===r?0:r,a=s.mediaPlayInfoVo,o=void 0===a?{}:a;e.initData(o),setTimeout((function(){e.player&&e.player.setCurrentTime(i)}),1e3)}}))},track:function(){try{var e=this.player.getCurrentTime()||0,t=Math.floor(e/60);t=t>9?t:"0"+t;var s=Math.floor(e%60);e=t+":"+(s=s>9?s:"0"+s);var r=this.courseInfo.courseName,i=this.currentCourseLessons,a=i.courseId,o=i.id,n=i.theme,u=i.videoMediaDTO;this.eduPlatTrack("StartWatchVideo",{courses_id:[String(a)],courses_name:[r],reclass_id:String(o),reclass_name:n,video_time:u.durationNum||0,start_time:e})}catch(l){}},playHandler:function(){var e=this.playerStatus,t=e.id,s=e.isPlaying;this.currentCourseLessons.id===t&&s?this.setLessonPlayer({id:this.currentCourseLessons.id,isPlaying:!1}):this.track();var r=this.getBasicInfo;(0,y.reportPlayInfo)((0,h.default)(r,{playInfo:(0,c.default)({isError:!1,error:""})}),!0),this.twoPlatTrack("1ncz",{address_id:"1ndk",content_id:this.currentCourseLessons.id||""})},timeupdateHandler:function(){var e=this;this.isLogin&&!this.uploadPlayInfo&&(this.uploadPlayInfo=setTimeout((function(){e.updateCourseLessonsHistory(!0),clearTimeout(e.uploadPlayInfo),e.uploadPlayInfo=!1}),3e3)),this.isLogin&&this.isReportHeart&&(this.isReportHeart=!1,this.setIsReportHeart(!0),setTimeout((function(){e.isReportHeart=!0}),61e3))},pauseHandle:function(){this.twoPlatTrack("1ncz",{address_id:"1ndm",content_id:this.currentCourseLessons.id||""}),this.setIsReportHeart(!1),this.isReportHeart=!0},endedHandler:function(){this.currentCourseLessons.fileId&&(this.player.setCurrentTime(0),this.player.pause()),clearTimeout(this.uploadPlayInfo),this.uploadPlayInfo=!1,this.updateCourseLessonsHistory(!1),this.setIsReportHeart(!1),this.isReportHeart=!0},errorHandler:function(e){var t=e.data,s=t&&t.code>13&&t.code<18,r=this.getBasicInfo;(0,y.reportPlayInfo)((0,h.default)(r,{playInfo:(0,c.default)({isError:!0,error:{code:t&&t.code,msg:t&&t.message,htmlPlayerErrorType:s?t.source.type:"",htmlPlayerErrorDetails:s?t.source.details:"",htmlPlayerErrorFrag:s?t.source.frag.baseurl:""}})}),!0)},updateCourseLessonsHistory:function(e){if(this.isLogin){var t=this.currentCourseLessons,s=t.courseId,r=t.sectionId,i=t.id,a=t.hasLearned,o=e?(0,d.default)(this.player&&this.player.getCurrentTime(),10):0;this.setLessonHistoryReq({courseId:s,sectionId:r,id:i,mediaType:1,historyNode:o,hasLearned:a})}}})};t.default=H},3509:function(e,t,s){},3510:function(e,t,s){"use strict";var r=s(45);s(21)(t,"__esModule",{value:!0}),t.default=void 0;var i=r(s(21)),a=r(s(443)),o=r(s(444)),n=r(s(175)),u=r(s(445)),l=r(s(442)),d=r(s(421)),c=r(s(482)),h=r(s(403)),p=r(s(420)),f=s(409),y=s(1521),m=s(461),I=s(474),P=s(544);function C(e,t){var s=(0,l.default)(e);if(u.default){var r=(0,u.default)(e);t&&(r=r.filter((function(t){return(0,n.default)(e,t).enumerable}))),s.push.apply(s,r)}return s}function v(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?C(Object(s),!0).forEach((function(t){(0,p.default)(e,t,s[t])})):o.default?(0,a.default)(e,(0,o.default)(s)):C(Object(s)).forEach((function(t){(0,i.default)(e,t,(0,n.default)(s,t))}))}return e}var H={name:"CourseVideo",components:{VideoPlayer:r(s(1522)).default},data:function(){return{player:null,uploadPlayInfo:!1,uploadPlayAuth:!1,appVersion:"",isReportHeart:!0,isTCPlayer:!0,appId:null,fileId:null,lessonId:null,isFirstCanPlay:!0,videoConfig:{}}},computed:v(v({},(0,f.mapGetters)(["currentCourseLessons","courseInfo","hasPurchaseClass","playerStatus","playerSecondCurrentTime","isTCPlayerChannel","iscanHideFast"])),{},{getBasicInfo:function(){return{userId:window.userInfo&&window.userInfo.id||"",currentEnvironment:this.currentEnvironment,browserName:m.browserName||"",OSName:m.OSName,browserVersion:m.fullVersion||"",appVersion:this.appVersion||"",courseId:this.currentCourseLessons.courseId,lessonId:this.currentCourseLessons.id}}}),created:function(){(0,I.isApp)()&&(this.appVersion=(0,I.getAppVersion)())},mounted:function(){this.getLessonPlayHistory()},beforeDestroy:function(){this.player&&this.player.getCurrentTime()&&this.currentCourseLessons.id===this.playerStatus.id&&this.setFormatPlayerCurrentTime(this.player.getCurrentTime()),clearTimeout(this.uploadPlayInfo),clearInterval(this.uploadPlayAuth),this.uploadPlayAuth=!1,this.uploadPlayInfo=!1,this.updateCourseLessonsHistory(!0),this.player&&this.player.dispose(),this.setIsReportHeart(!1),this.isReportHeart=!0},methods:v(v({},(0,f.mapActions)(["setCurrentCourseLessons","setFormatPlayerCurrentTime","setLessonPlayer","setIsReportHeart","setLessonHistoryReq"])),{},{initData:function(e){var t=this.currentCourseLessons,s=t.appId,r=(t.videoMediaDTO,t.id,e.aliPlayAuth),i=e.fileId,a=e.encryptMedia;this.videoConfig={appId:s,fileId:i,playAuth:r,isTCPlayer:this.isTCPlayerChannel,encryptMedia:a,controlBar:{playbackRateMenuButton:!this.iscanHideFast,progressControl:!this.iscanHideFast}},this.playerStatus&&this.playerStatus.isPlaying&&this.setLessonPlayer({id:this.playerStatus.id,isPlaying:!1})},setPlayer:function(e){this.player=e},getLessonPlayHistory:function(){var e=this;(0,P.fetchLessonPlayHistory)({lessonId:this.currentCourseLessons.id||""}).then((function(t){if(1===t.state){var s=t.content,r=s.historyNode,i=void 0===r?0:r,a=s.mediaPlayInfoVo,o=void 0===a?{}:a;e.initData(o),setTimeout((function(){e.player&&e.player.setCurrentTime(i)}),1e3)}}))},track:function(){try{var e=this.player.getCurrentTime()||0,t=Math.floor(e/60);t=t>9?t:"0"+t;var s=Math.floor(e%60);e=t+":"+(s=s>9?s:"0"+s);var r=this.courseInfo.courseName,i=this.currentCourseLessons,a=i.courseId,o=i.id,n=i.theme,u=i.videoMediaDTO;this.eduPlatTrack("StartWatchVideo",{courses_id:[String(a)],courses_name:[r],reclass_id:String(o),reclass_name:n,video_time:u.durationNum||0,start_time:e})}catch(l){}},playHandler:function(){var e=this.playerStatus,t=e.id,s=e.isPlaying;this.currentCourseLessons.id===t&&s?this.setLessonPlayer({id:this.currentCourseLessons.id,isPlaying:!1}):this.track();var r=this.getBasicInfo;(0,y.reportPlayInfo)((0,h.default)(r,{playInfo:(0,c.default)({isError:!1,error:""})}),!0),this.twoPlatTrack("1ncz",{address_id:"1ndk",content_id:this.currentCourseLessons.id||""})},timeupdateHandler:function(){var e=this;this.isLogin&&!this.uploadPlayInfo&&(this.uploadPlayInfo=setTimeout((function(){e.updateCourseLessonsHistory(!0),clearTimeout(e.uploadPlayInfo),e.uploadPlayInfo=!1}),3e3)),this.isLogin&&this.isReportHeart&&(this.isReportHeart=!1,this.setIsReportHeart(!0),setTimeout((function(){e.isReportHeart=!0}),61e3))},pauseHandle:function(){this.twoPlatTrack("1ncz",{address_id:"1ndm",content_id:this.currentCourseLessons.id||""}),this.setIsReportHeart(!1),this.isReportHeart=!0},endedHandler:function(){this.currentCourseLessons.fileId&&(this.player.setCurrentTime(0),this.player.pause()),clearTimeout(this.uploadPlayInfo),this.uploadPlayInfo=!1,this.updateCourseLessonsHistory(!1),this.setIsReportHeart(!1),this.isReportHeart=!0},errorHandler:function(e){var t=e.data,s=t&&t.code>13&&t.code<18,r=this.getBasicInfo;(0,y.reportPlayInfo)((0,h.default)(r,{playInfo:(0,c.default)({isError:!0,error:{code:t&&t.code,msg:t&&t.message,htmlPlayerErrorType:s?t.source.type:"",htmlPlayerErrorDetails:s?t.source.details:"",htmlPlayerErrorFrag:s?t.source.frag.baseurl:""}})}),!0)},updateCourseLessonsHistory:function(e){if(this.isLogin){var t=this.currentCourseLessons,s=t.courseId,r=t.sectionId,i=t.id,a=t.hasLearned,o=e?(0,d.default)(this.player&&this.player.getCurrentTime(),10):0;this.setLessonHistoryReq({courseId:s,sectionId:r,id:i,mediaType:1,historyNode:o,hasLearned:a})}}})};t.default=H},3511:function(e,t,s){"use strict";s.d(t,"a",(function(){return r})),s.d(t,"b",(function(){return i}));var r=function(){var e=this.$createElement;return(this._self._c||e)("VideoPlayer",{ref:"video",staticClass:"video-container",attrs:{"video-config":this.videoConfig},on:{setPlayer:this.setPlayer,play:this.playHandler,timeupdate:this.timeupdateHandler,pause:this.pauseHandle,ended:this.endedHandler,error:this.errorHandler}})},i=[]},581:function(e,t,s){var r=s(684),i=s(685),a=s(510),o=s(686);e.exports=function(e){return r(e)||i(e)||a(e)||o()}},684:function(e,t,s){var r=s(483),i=s(487);e.exports=function(e){if(r(e))return i(e)}},685:function(e,t,s){var r=s(477),i=s(509),a=s(181);e.exports=function(e){if("undefined"!==typeof a&&i(Object(e)))return r(e)}},686:function(e,t){e.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}}}]);
//# sourceMappingURL=16.41f1a95.js.map